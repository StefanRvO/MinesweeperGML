<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>started=0;
//show_message("client");
var serverHost;
//serverHost = get_string("Please enter the server's IP address or hostname", "127.0.0.1");
serverHost = global.ip_adress

serverSocket = tcp_connect(serverHost, 12345);
socket_sendbuffer_limit(serverSocket, 65536);

nextByteIsHeader = true;
expectedBytes = 1;
boardset=0;
restarts=0;

//interface
global.timer = 0;
lost = false;
won = false;
instance_create(530,50,obj_restart_button);
instance_create(698,-3,obj_Back_button3);
global.bomb_hit = false;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>started=1;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>t=0;
pointX=0;
pointY=0;

randomize();
//don't ask for this. server decides
//global.boardx=get_integer("antal felter vandret",5);
//global.boardy=get_integer("antal felter lodret",5);
//bombs=get_integer("antal bomber",5);
t=1;
//when t is set to 1, we start drawing (in control draw event)
global.flagsPlaced=0;
global.fieldsOpen=0;
opponentBombs=0;
opponentFieldsOpen=0;
opponentFlags=0;
opponentboardx=0;
opponentboardy=0;
restarts=0;
opponentRestarts=0;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>global.fieldsize=20;

//controls size of fileds
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if(started)
{
if(socket_has_error(serverSocket)) {
    instance_create(640,300,obj_Lost_connection);
}

/*The networking code sends and recives in the following format:
**First we send a byte (unsigned) which explains how many bytes the following message is
**The we send a header, again unigned byte
**acording to the header, we read som variables from the socket.
**When messeage is done, we check again for a new message.
*/
while(tcp_receive(serverSocket, expectedBytes)) {
    if(nextByteIsHeader) {
        expectedBytes = read_ubyte(serverSocket);
        nextByteIsHeader = false;
    } else {
        var messageType;
        messageType = read_ubyte(serverSocket);
        switch(messageType) {
        //switchcases depending on messages
        case TOTALBOMBS:
        opponentBombs=read_int(serverSocket);
        break;
        case OPENFIELDS:
        opponentFieldsOpen=read_int(serverSocket);
        break;
        case PLACEDFLAGS:
        opponentFlags=read_int(serverSocket);
        break;
        break;
        case BOARDSIZE:
        opponentboardx=read_int(serverSocket);
        opponentboardy=read_int(serverSocket);
        break;
        case RESTARTS:
        opponentRestarts=read_short(serverSocket);
        break;
        
        //here we should recive data from server
        default:
        //do nothing on unknown
        }
        nextByteIsHeader = true;
        expectedBytes = 1;

        }
        }
global.boardy=opponentboardy;
global.boardx=opponentboardx;
bombs=opponentBombs;
boardset=1;
write_ubyte(serverSocket,5);
write_ubyte(serverSocket,TOTALBOMBS);
write_int(serverSocket,bombs);

write_ubyte(serverSocket,5);
write_ubyte(serverSocket,OPENFIELDS);
write_int(serverSocket,global.fieldsOpen);

write_ubyte(serverSocket,5);
write_ubyte(serverSocket,PLACEDFLAGS);
write_int(serverSocket,global.flagsPlaced);

write_ubyte(serverSocket,9);
write_ubyte(serverSocket,BOARDSIZE);
write_int(serverSocket,global.boardx);
write_int(serverSocket,global.boardy);

write_ubyte(serverSocket,3);
write_ubyte(serverSocket,RESTARTS);
write_short(serverSocket,restarts);


socket_send(serverSocket);
        
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//timer
if (global.timer &lt; 999 &amp;&amp; lost == false &amp;&amp; won == false) {
    global.timer += 1/30;
}

//button retry
if (global.t == true) {
    t = 1;
    lost = false;
    won = false;
    global.t = false;
    global.timer = 0;
}

//multiplayer == win
if (global.fieldsOpen == global.boardy * global.boardx - bombs &amp;&amp; won == false &amp;&amp; global.timer&gt;2) {
    won = true;
    //global.fieldsOpen = 0;
    instance_create(640,500,obj_Menu_button2);
}

//multiplayer == loose
if (opponentFieldsOpen &gt;= 1 &amp;&amp; opponentboardy * opponentboardx - opponentBombs &gt;= 1) {
    if (opponentFieldsOpen = opponentboardy * opponentboardx - opponentBombs) {
        lost = true;

        instance_create(640,500,obj_Menu_button2);
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="6" enumb="54">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (lost == false &amp;&amp; won == false &amp;&amp; global.bomb_hit == false) {    
    if (t==0) //prevent fault if board isn't generated yet.
    //if we got time, we should implent the possabillity to place flags before the board is generated
    {
        pointX=floor(mouse_x/global.fieldsize); 
        pointY=floor((mouse_y-101)/global.fieldsize);
        if (pointX&gt;global.boardx-1 || pointY&gt;global.boardy-1)
        exit;
        if (pointX&lt;0 || pointY&lt;0)
        exit;
        //show_message(string(pointX)+" , "+string(pointY));
        //place or remove flag
        ds_grid_create(global.boardx,global.boardy);
                for(i=0;i&lt;global.boardx;i+=1)
                {
                    for(j=0;j&lt;global.boardy;j+=1)
                    {   
                    ds_grid_add(0,i,j,global.bombarray[i,j]);
                    }
                }
        clickField(pointX,pointY,1);
        countStats();
    
        for (i=0;i&lt;global.boardx;i+=1)
        {
            for(j=0;j&lt;global.boardy;j+=1)
            {
                global.bombarray[i,j]=ds_grid_get(0,i,j);
            }
        }
        ds_grid_destroy(0);
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="6" enumb="50">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (lost == false &amp;&amp; won == false &amp;&amp; global.bomb_hit == false) {
    pointX=floor(mouse_x/global.fieldsize);
    pointY=floor((mouse_y-101)/global.fieldsize);
    if (pointX&gt;global.boardx-1 || pointY&gt;global.boardy-1)
         exit;
    if (pointX&lt;0 || pointY&lt;0)
        exit;
    if (t)
    {
        generateBombPlacement(global.boardx,global.boardy,bombs,pointX,pointY);
        generateBoardNumbers();
        for (i=0;i&lt;global.boardx;i+=1)
        {
            for(j=0;j&lt;global.boardy;j+=1)
            {
                global.bombarray[i,j]=ds_grid_get(0,i,j);
            }
        }
        ds_grid_destroy(0);
    
        for (i=0;i&lt;global.boardx;i+=1)
        {
            for(j=0;j&lt;global.boardy;j+=1)
            {
                instance_create(i*global.fieldsize,j*global.fieldsize,obj_field);
            }
        }
        //don't draw the board anymore. this is now handled by obj_field
        t=0;
    }
    //show_message(string(pointX)+" , "+string(pointY));
    ds_grid_create(global.boardx,global.boardy);
            for(i=0;i&lt;global.boardx;i+=1)
            {
                for(j=0;j&lt;global.boardy;j+=1)
                {   
                ds_grid_add(0,i,j,global.bombarray[i,j]);
                }
            }
            //reset board if we hit a bomb
    if(clickField(pointX,pointY,0)==29)
    {
        restarts+=1;
        instance_create(640,300,obj_Hit_bomb);
        /*show_message("You hit a bomb, board has been reset");
        t=1;
        */
    }
    countStats();


    for (i=0;i&lt;global.boardx;i+=1)
    {
        for(j=0;j&lt;global.boardy;j+=1)
        {
            global.bombarray[i,j]=ds_grid_get(0,i,j);
        }
    }
    ds_grid_destroy(0);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>draw_sprite(spr_Ingame_top_multiplayer,0,0,0 - 50);

if (lost == true) {
    draw_sprite(spr_You_Lost,0,350,150);
}
if (won == true) {
    draw_sprite(spr_You_Won,0,350,150);
}

draw_set_color(c_black);
draw_text_transformed(600,42,global.timer,1.5,1.5,0);

//draw initial board with no open fields
//stop drawing after player has pressed a field
if(boardset){
    if(t) {
    for(i=0;i&lt;global.boardx;i+=1) {
        for (j=0;j&lt;global.boardy;j+=1) {
            draw_sprite(spr_closed,0,global.fieldsize*i,global.fieldsize*j + 101);
            }
        }
    }

//you
    draw_set_color(c_blue);
    //Open
    draw_text_transformed(40,26,"Open:",1.3,1.3,0);
    draw_text_transformed(40,56,string(global.fieldsOpen) + "/" + string(global.boardy * global.boardx-bombs),1.3,1.3,0);
    
    //Bombs
    draw_text_transformed(210,26,"Bombs:",1.3,1.3,0);
    draw_text_transformed(210,56,string(global.flagsPlaced) + "/"+string(bombs),1.3,1.3,0);
    
    //Restarts
    draw_text_transformed(368,26,"Restarts:",1.3,1.3,0);
    draw_text_transformed(368,56,string(restarts),1.3,1.3,0);
    
//Opponent
    draw_set_color(c_red);
    //Open
    draw_text_transformed(1115,26,"Open:",1.3,1.3,0);
    draw_text_transformed(1115,56,string(opponentFieldsOpen) + "/" + string(opponentboardy*opponentboardx-opponentBombs),1.3,1.3,0)
     
    //Bombs
    draw_text_transformed(950,26,"Bombs:",1.3,1.3,0);
    draw_text_transformed(950,56,string(opponentFlags) + "/" + string(opponentBombs),1.3,1.3,0);
    
    //Restarts
    draw_text_transformed(814,26,"Restarts:",1.3,1.3,0);
    draw_text_transformed(814,56,string(opponentRestarts),1.3,1.3,0);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="10" enumb="40">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>t = 1;
restarts+=1;
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsShapePoints/>
</object>
